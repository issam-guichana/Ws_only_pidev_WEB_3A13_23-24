{% extends 'admin.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
{% endblock %}

{% block content %}
<div class="page-content">
     <div class="title-container">
        <h2 class="form-title"> <i class="fas fa-lightbulb"  style="margin-right: 10px;"></i>Discussions sur Formini.TN</h2>
    </div>
    <table class="table table-striped table-bordered">
        <thead class="thead-dark">
            <tr>
                <th scope="col">Nom Room</th>
                <th scope="col">Description</th>
                <th scope="col">Date creation</th>
                <th scope="col">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for room in rooms %}
                <tr>
                    <td>{{ room.nomRoom }}</td>
                    <td>{{ room.description }}</td>
                    <td>{{ room.dateCRoom|date('Y-m-d') }}</td>
                    <td>
                        <td>
    <a href="{{ path('app_room_d',
     {'id': room.IdRoom }) }}" class="btn btn-primary consulter-btn" data-room-id="{{ room.IdRoom}}" data-toggle="modal" data-target="#messagesModal">Messages</a>

    <a href="{{ path('updateroom',
     {'id': room.IdRoom }) }}" class="btn btn-primary editer-btn" data-room-id="{{ room.IdRoom }}" data-toggle="modal" data-target="#updateModal">Editer</a>
<a href="{{ path('deleteroom',
     {'id': room.IdRoom }) }}" class="btn btn-primary delete-btn" data-room-id="{{ room.IdRoom }}" data-toggle="modal" >Supprimer</a>
</td>

                    
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>


<!-- Modal for displaying messages -->
<div class="modal fade" id="messagesModal" tabindex="-1" role="dialog" aria-labelledby="messagesModalLabel" aria-hidden="true">
    <!-- Modal content goes here -->

    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="messagesModalLabel">Messages de la Salle</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <ul id="messagesList"></ul> <!-- Placeholder for messages list -->
            </div>
        </div>
    </div>
</div>
<!-- Modal for updating room details -->
<div class="modal fade" id="updateModal" tabindex="-1" role="dialog" aria-labelledby="updateModalLabel" aria-hidden="true">
    <div class="modal fade" id="updateModal" tabindex="-1" role="dialog" aria-labelledby="updateModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="updateModalLabel">Update Room Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Form for updating room details -->
                <form action="{{ path('updateroom', {'id': '__roomId__'}) }}" method="post">
                    <!-- Update the action attribute with the correct route and room ID -->
                    <!-- Include form fields for updating room details -->
                    <!-- Example: -->
                    <div class="form-group">
                        <label for="roomName">Room Name</label>
                        <input type="text" class="form-control" id="roomName" name="roomName">
                    </div>
                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea class="form-control" id="description" name="description"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Update</button>
                </form>
            </div>
        </div>
    </div>
</div>
</div>


{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <!-- Ensure jQuery is loaded before your custom JavaScript code -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            // Event listener for Consulter button
            $('.consulter-btn').click(function(event) {
                event.preventDefault(); // Prevent default anchor behavior

                var roomId = $(this).data('room-id');

                // Fetch messages data for the room
                $.get('{{ path('app_room_d', {'id': '__roomId__'}) }}'.replace('__roomId__', roomId), function(response) {
                    // Update modal content with messages
                    var messages = response.messages;
                    var messagesList = $('#messagesList');
                    messagesList.empty(); // Clear previous messages

                    messages.forEach(function(message) {
                        var listItem = $('<li>').text(message.contenu); // Assuming the content property of the message entity
                        messagesList.append(listItem);
                    });

                    // Show the modal
                    $('#messagesModal').modal('show');
                }).fail(function(jqXHR, textStatus, errorThrown) {
                    // Handle errors here
                    console.error("Error:", textStatus, errorThrown);
                });
            });
        });
    </script>

    <style>
.page-content {
        font-family: Georgia, serif; /* Apply font-family to page content */
    }

title-container {
            text-align: center; /* Center the title */
            margin-bottom: 40px; /* Add some space below the title */
        }
/* Modal styles */
.modal {
     width:50%;
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0, 0, 0, 0.4); /* Semi-transparent black background */
}

.modal-content {
  background-color: #fefefe; /* White background */
  margin: 15% auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
  border-radius: 10px; /* Rounded corners */
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.3); /* Drop shadow */
}

.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}

/* Card styles */
.card {
   
  border: 1px solid #ccc; /* Card border */
  border-radius: 10px; /* Rounded corners */
  margin-bottom: 20px; /* Spacing between cards */
}

.card-header {
 background-color: #213E60;  /* Card header background color */
  padding: 10px;
  border-bottom: 1px solid #ccc; /* Border bottom */
}

.card-title {
  margin-bottom: 0;
  /* Remove margin bottom for card title */
}

</style>



{% endblock %}
