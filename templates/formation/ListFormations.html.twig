{% extends 'admin.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
{% endblock %}

{% block content %}
    <h1>Liste des Formations</h1>

    <table class="table">
        <thead>
            <tr>
                <th>Nom</th>
                <th>Description</th>
                <th>Catégorie</th>
                <th>Room</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for formation in formations %}
                <tr>
                    <td>{{ formation.nomForm }}</td>
                    <td>{{ formation.description }}</td>
                    <td>{{ formation.cat.nomCat }}</td>
                    <td>
                        {% set userFormRoom = userFormRooms[formation.getIdForm()] %}
                        {% if userFormRoom is not empty %}
        <a href="{{ path('app_get_room_details', {'id': userFormRoom[0].getRoom().getIdRoom()}) }}" class="room-link" data-room-id="{{ userFormRoom[0].getRoom().getIdRoom() }}">{{ userFormRoom[0].getRoom().getNomRoom() }}</a>
                        {% else %}
                            N/A
                        {% endif %}
                        <div class="room-details" style="display: none;"></div>
                    </td>
                    <td>
                        <a href="{{ path('app_formation_edit', {'idForm': formation.idForm}) }}">Éditer</a>
                        {{ include('formation/_delete_form.html.twig', {'idForm': formation.idForm}) }}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <a href="{{ path('app_formation_new') }}">Créer une nouvelle formation</a>
    <a href="{{ path('app_user_form_room_index') }}">Liste des formateurs et participants</a>

<script>
        document.addEventListener("DOMContentLoaded", function() {
            const roomLinks = document.querySelectorAll(".room-link");
            
            roomLinks.forEach(link => {
                link.addEventListener("click", function(event) {
                    event.preventDefault();
                    const roomId = link.getAttribute("data-room-id");
                    fetchRoomDetails(roomId);
                });
            });

            function fetchRoomDetails(roomId) {
                fetch(`/formation/rooms/${roomId}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error("Room not found");
                        }
                        return response.json();
                    })
                    .then(data => {
                        openModalWithData(data);
                    })
                    .catch(error => {
                        console.error(error);
                    });
            }
        });
    </script>

	<!-- Modal -->
<div class="modal fade" id="roomModal" tabindex="-1" role="dialog" aria-labelledby="roomModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="roomModalLabel">Room Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Room details will be displayed here -->
                <p id="roomName"></p>
                <p id="roomDescription"></p>
            </div>
        </div>
    </div>
</div>
<!-- Include jQuery from a CDN -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

<!-- Your other script that uses jQuery -->
<script>
    // Function to open modal and display room details
    function openModalWithData(data) {
        // Update modal content with room details
        document.getElementById('roomName').innerText = data.nom;
        document.getElementById('roomDescription').innerText = data.description;

        // Open the modal
        $('#roomModal').modal('show');
    }

    // Your other JavaScript code here...
</script>
<style> .modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.4);
}

.modal-content {
  background-color: #fefefe;
  margin: 15% auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
}

.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}
 </style>

{% endblock %}
